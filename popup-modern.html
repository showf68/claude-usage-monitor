<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      width: 380px;
      min-height: 300px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f1419;
      color: #e4e7eb;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 40px;
      height: 36px;
      background: rgba(255,255,255,0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
    }

    .title { flex: 1; }
    .title h1 { font-size: 14px; font-weight: 700; }
    .title .plan { font-size: 11px; opacity: 0.85; margin-top: 1px; }

    .header-actions { display: flex; gap: 6px; }

    .icon-btn {
      background: rgba(255,255,255,0.15);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .icon-btn:hover { background: rgba(255,255,255,0.25); }
    .icon-btn.settings:hover svg { animation: spin 1s linear infinite; }
    .icon-btn.spinning svg { animation: spin 1s linear infinite; }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Content */
    .content { padding: 16px; }

    /* Circles */
    .circles-container {
      display: flex;
      justify-content: space-around;
      margin-bottom: 14px;
      gap: 12px;
    }

    .circle-card { flex: 1; text-align: center; }

    .circle-wrapper {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 auto 8px;
    }

    .circle-svg { transform: rotate(-90deg); }
    .circle-bg { fill: none; stroke: rgba(255,255,255,0.08); stroke-width: 8; }

    .circle-progress {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
    }

    .circle-progress.low { stroke: #22c55e; }
    .circle-progress.medium { stroke: #f59e0b; }
    .circle-progress.high { stroke: #ef4444; }

    .circle-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .circle-percent { font-size: 22px; font-weight: 800; line-height: 1; }
    .circle-percent.low { color: #22c55e; }
    .circle-percent.medium { color: #f59e0b; }
    .circle-percent.high { color: #ef4444; }

    .circle-label {
      font-size: 9px;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      margin-top: 2px;
    }

    .reset-time { font-size: 10px; color: #64748b; }
    .reset-time span { color: #f59e0b; font-weight: 600; }

    /* Info Card */
    .info-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 10px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      font-size: 11px;
    }

    .info-label { color: #94a3b8; }
    .info-value { font-weight: 600; color: #e4e7eb; }

    /* Setup */
    .setup { padding: 16px; }
    .setup h2 {
      font-size: 16px;
      margin-bottom: 12px;
      color: #f59e0b;
    }

    .setup label {
      font-size: 11px;
      color: #94a3b8;
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .setup textarea {
      width: 100%;
      height: 100px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #f1f5f9;
      font-size: 11px;
      font-family: monospace;
      margin-bottom: 10px;
      resize: vertical;
    }

    .setup textarea:focus {
      outline: none;
      border-color: #f59e0b;
    }

    .btn-primary {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #d97706, #f59e0b);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 13px;
    }

    .btn-primary:hover { opacity: 0.9; }

    .file-hint {
      background: rgba(245,158,11,0.1);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 6px;
      padding: 10px;
      font-size: 11px;
      color: #fbbf24;
      margin-bottom: 12px;
      cursor: pointer;
      text-align: center;
    }

    .file-hint:hover { background: rgba(245,158,11,0.15); }

    /* Error */
    .error-container {
      padding: 16px;
    }

    .error-box {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .error-title {
      color: #ef4444;
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .error-message {
      color: #f87171;
      font-size: 11px;
      margin-bottom: 12px;
      word-break: break-all;
      background: rgba(0,0,0,0.2);
      padding: 8px;
      border-radius: 4px;
      font-family: monospace;
      text-align: left;
      max-height: 80px;
      overflow-y: auto;
    }

    .error-box button {
      padding: 10px 20px;
      background: rgba(239,68,68,0.2);
      border: 1px solid rgba(239,68,68,0.4);
      border-radius: 6px;
      color: #ef4444;
      font-size: 12px;
      cursor: pointer;
      font-weight: 600;
      margin: 4px;
    }

    .error-box button:hover { background: rgba(239,68,68,0.3); }

    /* Modal */
    .modal-backdrop {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      padding: 20px;
    }

    .modal-backdrop.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal {
      background: #1a1f2e;
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 16px;
      padding: 20px;
      width: 340px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal h2 {
      font-size: 18px;
      color: #f59e0b;
      margin: 0;
    }

    .modal-close {
      background: rgba(255,255,255,0.05);
      border: none;
      color: #94a3b8;
      font-size: 20px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover { background: rgba(239,68,68,0.2); color: #ef4444; }

    .modal label {
      font-size: 12px;
      color: #94a3b8;
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .modal textarea {
      width: 100%;
      height: 120px;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #f1f5f9;
      font-size: 11px;
      font-family: monospace;
      margin-bottom: 12px;
      resize: vertical;
    }

    .modal textarea:focus { outline: none; border-color: #f59e0b; }

    .modal .file-hint {
      margin-bottom: 12px;
    }

    .modal .btn-primary {
      margin-top: 4px;
    }

    .modal-footer {
      font-size: 10px;
      color: #64748b;
      text-align: center;
      margin-top: 12px;
    }

    /* Success indicator */
    .parse-result {
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      font-size: 11px;
    }

    .parse-result.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #4ade80;
    }

    .parse-result.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    .parse-result .token-info {
      margin-top: 6px;
      font-family: monospace;
      word-break: break-all;
    }

    /* Debug info */
    .debug-info {
      margin-top: 12px;
      padding: 10px;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      font-size: 10px;
      color: #93c5fd;
    }

    .debug-info code {
      display: block;
      background: rgba(0,0,0,0.2);
      padding: 6px;
      border-radius: 4px;
      margin-top: 6px;
      word-break: break-all;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="logo">CC</div>
    <div class="title">
      <h1>Claude Usage Monitor</h1>
      <div class="plan" id="plan" style="display:none;"></div>
    </div>
    <div class="header-actions">
      <button class="icon-btn settings" id="settingsBtn" title="Settings">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
      <button class="icon-btn" id="refreshBtn" title="Refresh">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="content" id="content">
    <!-- Setup View -->
    <div class="setup" id="setupView" style="display:none;">
      <h2>Configuration</h2>

      <div class="file-hint" id="openCredentials">
        ðŸ“‹ Click to copy .credentials.json path
      </div>

      <label>Paste your .credentials.json content:</label>
      <textarea id="jsonInput" placeholder='{"claudeAiOauth":{"accessToken":"sk-ant-oat01-...","refreshToken":"sk-ant-ort01-..."}}'></textarea>

      <div id="parseResult"></div>

      <button class="btn-primary" id="saveBtn">Save & Connect</button>

      <div class="debug-info">
        Open the file and copy ALL its content (Ctrl+A, Ctrl+C)
        <code>%USERPROFILE%\.claude\.credentials.json</code>
      </div>
    </div>

    <!-- Usage View -->
    <div id="usageView" style="display:none;">
      <div class="circles-container">
        <div class="circle-card">
          <div class="circle-wrapper">
            <svg class="circle-svg" width="100" height="100">
              <circle class="circle-bg" cx="50" cy="50" r="42"/>
              <circle class="circle-progress low" id="circle5h" cx="50" cy="50" r="42"
                      stroke-dasharray="263.89" stroke-dashoffset="0"/>
            </svg>
            <div class="circle-text">
              <div class="circle-percent" id="percent5h">--%</div>
              <div class="circle-label">5 Hours</div>
            </div>
          </div>
          <div class="reset-time"><span id="reset5h">--</span></div>
        </div>

        <div class="circle-card">
          <div class="circle-wrapper">
            <svg class="circle-svg" width="100" height="100">
              <circle class="circle-bg" cx="50" cy="50" r="42"/>
              <circle class="circle-progress low" id="circle7d" cx="50" cy="50" r="42"
                      stroke-dasharray="263.89" stroke-dashoffset="0"/>
            </svg>
            <div class="circle-text">
              <div class="circle-percent" id="percent7d">--%</div>
              <div class="circle-label">7 Days</div>
            </div>
          </div>
          <div class="reset-time"><span id="reset7d">--</span></div>
        </div>
      </div>

      <div class="info-card">
        <div class="info-row">
          <span class="info-label">Last Updated</span>
          <span class="info-value" id="lastUpdate">--</span>
        </div>
      </div>
    </div>

    <!-- Error View -->
    <div class="error-container" id="errorView" style="display:none;">
      <div class="error-box">
        <div class="error-title">Connection Error</div>
        <div class="error-message" id="errorMessage">Unknown error</div>
        <button id="retryBtn">Retry</button>
        <button id="reconfigureBtn">Reconfigure</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>

      <div class="file-hint" id="openCredentialsModal">
        ðŸ“‹ Click to copy .credentials.json path
      </div>

      <label>Paste your .credentials.json content:</label>
      <textarea id="modalJsonInput" placeholder='{"claudeAiOauth":{"accessToken":"sk-ant-oat01-..."}}'></textarea>

      <div id="modalParseResult"></div>

      <button class="btn-primary" id="modalSave">Save & Connect</button>

      <div class="modal-footer">v3.2 - Paste the entire JSON file content</div>
    </div>
  </div>

  <script src="popup-modern.js"></script>
</body>
</html>
