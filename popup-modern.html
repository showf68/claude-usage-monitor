<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      width: 400px;
      min-height: 320px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f1419;
      color: #e4e7eb;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 40px;
      height: 36px;
      background: rgba(255,255,255,0.15);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
    }

    .title { flex: 1; }
    .title h1 { font-size: 14px; font-weight: 700; }
    .title .plan { font-size: 11px; opacity: 0.85; margin-top: 1px; }

    .header-actions { display: flex; gap: 6px; }

    .icon-btn {
      background: rgba(255,255,255,0.15);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .icon-btn:hover { background: rgba(255,255,255,0.25); }
    .icon-btn.settings:hover svg { animation: spin 1s linear infinite; }
    .icon-btn.spinning svg { animation: spin 1s linear infinite; }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Language Selector */
    .lang-selector {
      position: relative;
    }

    .lang-btn {
      background: rgba(255,255,255,0.15);
      border: none;
      padding: 4px 8px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      height: 32px;
      transition: background 0.2s;
    }

    .lang-btn:hover { background: rgba(255,255,255,0.25); }

    .lang-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 4px;
      background: #1a1f2e;
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 8px;
      overflow: hidden;
      z-index: 100;
      min-width: 120px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .lang-dropdown.show { display: block; }

    .lang-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 12px;
      color: #e4e7eb;
      transition: background 0.2s;
    }

    .lang-option:hover { background: rgba(245, 158, 11, 0.2); }
    .lang-option.active { background: rgba(245, 158, 11, 0.3); }

    /* Content */
    .content { padding: 16px; }

    /* Circles */
    .circles-container {
      display: flex;
      justify-content: space-around;
      margin-bottom: 14px;
      gap: 12px;
    }

    .circle-card { flex: 1; text-align: center; }

    .circle-wrapper {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 auto 8px;
    }

    .circle-svg { transform: rotate(-90deg); }
    .circle-bg { fill: none; stroke: rgba(255,255,255,0.08); stroke-width: 8; }

    .circle-progress {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
    }

    .circle-progress.low { stroke: #22c55e; }
    .circle-progress.medium { stroke: #f59e0b; }
    .circle-progress.high { stroke: #ef4444; }

    .circle-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .circle-percent { font-size: 22px; font-weight: 800; line-height: 1; }
    .circle-percent.low { color: #22c55e; }
    .circle-percent.medium { color: #f59e0b; }
    .circle-percent.high { color: #ef4444; }

    .circle-label {
      font-size: 9px;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
      margin-top: 2px;
    }

    .reset-time { font-size: 10px; color: #64748b; }
    .reset-time span { color: #f59e0b; font-weight: 600; }

    /* Info Card */
    .info-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 10px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      font-size: 11px;
    }

    .info-label { color: #94a3b8; }
    .info-value { font-weight: 600; color: #e4e7eb; }

    /* Setup */
    .setup { padding: 16px; }
    .setup h2 {
      font-size: 16px;
      margin-bottom: 12px;
      color: #f59e0b;
    }

    .setup label {
      font-size: 11px;
      color: #94a3b8;
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .setup textarea {
      width: 100%;
      height: 100px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #f1f5f9;
      font-size: 11px;
      font-family: monospace;
      margin-bottom: 10px;
      resize: vertical;
    }

    .setup textarea:focus {
      outline: none;
      border-color: #f59e0b;
    }

    .btn-primary {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #d97706, #f59e0b);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 13px;
    }

    .btn-primary:hover { opacity: 0.9; }

    .file-hint {
      background: rgba(245,158,11,0.1);
      border: 1px solid rgba(245,158,11,0.2);
      border-radius: 6px;
      padding: 10px;
      font-size: 11px;
      color: #fbbf24;
      margin-bottom: 12px;
      cursor: pointer;
      text-align: center;
    }

    .file-hint:hover { background: rgba(245,158,11,0.15); }

    /* Error */
    .error-container {
      padding: 16px;
    }

    .error-box {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .error-title {
      color: #ef4444;
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .error-message {
      color: #f87171;
      font-size: 11px;
      margin-bottom: 12px;
      word-break: break-all;
      background: rgba(0,0,0,0.2);
      padding: 8px;
      border-radius: 4px;
      font-family: monospace;
      text-align: left;
      max-height: 80px;
      overflow-y: auto;
    }

    .error-box button {
      padding: 10px 20px;
      background: rgba(239,68,68,0.2);
      border: 1px solid rgba(239,68,68,0.4);
      border-radius: 6px;
      color: #ef4444;
      font-size: 12px;
      cursor: pointer;
      font-weight: 600;
      margin: 4px;
    }

    .error-box button:hover { background: rgba(239,68,68,0.3); }

    /* Modal */
    .modal-backdrop {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 400px;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 1000;
      padding: 16px;
      overflow-y: auto;
    }

    .modal-backdrop.show {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 20px;
    }

    .modal {
      background: #1a1f2e;
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 12px;
      padding: 14px;
      width: 100%;
      max-width: 360px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .modal h2 {
      font-size: 16px;
      color: #f59e0b;
      margin: 0;
    }

    .modal-close {
      background: rgba(255,255,255,0.05);
      border: none;
      color: #94a3b8;
      font-size: 20px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover { background: rgba(239,68,68,0.2); color: #ef4444; }

    .modal label {
      font-size: 11px;
      color: #94a3b8;
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .modal textarea {
      width: 100%;
      height: 80px;
      padding: 10px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #f1f5f9;
      font-size: 10px;
      font-family: monospace;
      margin-bottom: 8px;
      resize: none;
    }

    .modal textarea:focus { outline: none; border-color: #f59e0b; }

    .modal .file-hint {
      margin-bottom: 8px;
      padding: 8px;
      font-size: 10px;
    }

    .modal .btn-primary {
      margin-top: 2px;
      padding: 10px;
      font-size: 12px;
    }

    .modal-footer {
      font-size: 9px;
      color: #64748b;
      text-align: center;
      margin-top: 8px;
    }

    /* Auth Mode Tabs */
    .auth-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 4px;
    }

    .auth-tab {
      flex: 1;
      padding: 8px 12px;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: #94a3b8;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .auth-tab:hover {
      color: #e4e7eb;
      background: rgba(255,255,255,0.05);
    }

    .auth-tab.active {
      background: linear-gradient(135deg, #d97706, #f59e0b);
      color: white;
    }

    .auth-tab svg {
      width: 14px;
      height: 14px;
    }

    .auth-content {
      display: none;
    }

    .auth-content.active {
      display: block;
    }

    .cookie-status {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .cookie-status.checking {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #93c5fd;
    }

    .cookie-status.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #4ade80;
    }

    .cookie-status.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    .cookie-status svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .cookie-hint {
      font-size: 10px;
      color: #64748b;
      margin-top: 8px;
      line-height: 1.4;
    }

    /* Success indicator */
    .parse-result {
      margin-top: 6px;
      margin-bottom: 6px;
      padding: 8px;
      border-radius: 6px;
      font-size: 10px;
    }

    .parse-result.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: #4ade80;
    }

    .parse-result.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    .parse-result .token-info {
      margin-top: 6px;
      font-family: monospace;
      word-break: break-all;
    }

    /* Debug info */
    .debug-info {
      margin-top: 12px;
      padding: 10px;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      font-size: 10px;
      color: #93c5fd;
    }

    .debug-info code {
      display: block;
      background: rgba(0,0,0,0.2);
      padding: 6px;
      border-radius: 4px;
      margin-top: 6px;
      word-break: break-all;
      font-family: monospace;
    }

    /* Footer */
    .footer {
      padding: 12px 16px;
      text-align: center;
      border-top: 1px solid rgba(255,255,255,0.08);
      margin-top: 8px;
    }

    .footer a {
      color: #64748b;
      text-decoration: none;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: color 0.2s;
    }

    .footer a:hover {
      color: #f59e0b;
    }

    .footer svg {
      width: 14px;
      height: 14px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="logo">CC</div>
    <div class="title">
      <h1>Claude Usage Monitor</h1>
      <div class="plan" id="plan" style="display:none;"></div>
    </div>
    <div class="header-actions">
      <div class="lang-selector">
        <button class="lang-btn" id="langBtn" title="Language">
          <span id="currentLangFlag">EN</span>
          <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
        </button>
        <div class="lang-dropdown" id="langDropdown">
          <div class="lang-option" data-lang="en">EN English</div>
          <div class="lang-option" data-lang="fr">FR Francais</div>
          <div class="lang-option" data-lang="es">ES Espanol</div>
          <div class="lang-option" data-lang="zh">ZH Chinese</div>
          <div class="lang-option" data-lang="he">HE Hebrew</div>
        </div>
      </div>
      <button class="icon-btn settings" id="settingsBtn" title="Settings">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
      <button class="icon-btn" id="refreshBtn" title="Refresh">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="content" id="content">
    <!-- Setup View -->
    <div class="setup" id="setupView" style="display:none;">
      <h2 data-i18n="configuration">Configuration</h2>
      <p style="text-align:center;color:#94a3b8;margin-bottom:24px;" data-i18n="chooseMethod">Choose your authentication method:</p>

      <button class="btn-primary" id="setupLoginBtn" style="margin-bottom:12px;">
        üîó <span data-i18n="loginToClaude">Login to Claude.ai</span>
      </button>
      <p style="text-align:center;font-size:11px;color:#64748b;margin-bottom:24px;" data-i18n="cookieMode">Recommended - Uses browser cookies</p>

      <div style="text-align:center;margin:20px 0;color:#475569;">‚îÄ‚îÄ or ‚îÄ‚îÄ</div>

      <button class="btn-secondary" id="setupSettingsBtn">
        ‚öôÔ∏è <span data-i18n="configureManually">Configure with JSON</span>
      </button>
      <p style="text-align:center;font-size:11px;color:#64748b;margin-top:8px;" data-i18n="jsonMode">Advanced - Paste .credentials.json</p>
    </div>

    <!-- Usage View -->
    <div id="usageView" style="display:none;">
      <div class="circles-container">
        <div class="circle-card">
          <div class="circle-wrapper">
            <svg class="circle-svg" width="100" height="100">
              <circle class="circle-bg" cx="50" cy="50" r="42"/>
              <circle class="circle-progress low" id="circle5h" cx="50" cy="50" r="42"
                      stroke-dasharray="263.89" stroke-dashoffset="0"/>
            </svg>
            <div class="circle-text">
              <div class="circle-percent" id="percent5h">--%</div>
              <div class="circle-label" data-i18n="hours5">5 Hours</div>
            </div>
          </div>
          <div class="reset-time"><span id="reset5h">--</span></div>
        </div>

        <div class="circle-card">
          <div class="circle-wrapper">
            <svg class="circle-svg" width="100" height="100">
              <circle class="circle-bg" cx="50" cy="50" r="42"/>
              <circle class="circle-progress low" id="circle7d" cx="50" cy="50" r="42"
                      stroke-dasharray="263.89" stroke-dashoffset="0"/>
            </svg>
            <div class="circle-text">
              <div class="circle-percent" id="percent7d">--%</div>
              <div class="circle-label" data-i18n="days7">7 Days</div>
            </div>
          </div>
          <div class="reset-time"><span id="reset7d">--</span></div>
        </div>
      </div>

      <div class="info-card">
        <div class="info-row">
          <span class="info-label" data-i18n="lastUpdated">Last Updated</span>
          <span class="info-value" id="lastUpdate">--</span>
        </div>
      </div>
    </div>

    <!-- Error View -->
    <div class="error-container" id="errorView" style="display:none;">
      <div class="error-box">
        <div class="error-title" data-i18n="connectionError">Connection Error</div>
        <div class="error-message" id="errorMessage">Unknown error</div>
        <button id="loginBtn" data-i18n="loginToClaude" style="display:none;">üîó Login to Claude.ai</button>
        <button id="retryBtn" data-i18n="retry">Retry</button>
        <button id="reconfigureBtn" data-i18n="reconfigure">Reconfigure</button>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <a href="https://github.com/showf68/claude-usage-monitor" target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
        GitHub
      </a>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 data-i18n="settings">Settings</h2>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>

      <!-- Auth Mode Tabs -->
      <div class="auth-tabs">
        <button class="auth-tab active" id="tabCookie" data-mode="cookie">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span data-i18n="autoMode">Auto (Cookie)</span>
        </button>
        <button class="auth-tab" id="tabToken" data-mode="token">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
          </svg>
          <span data-i18n="manualMode">Manual (Token)</span>
        </button>
      </div>

      <!-- Cookie Mode Content -->
      <div class="auth-content active" id="cookieContent">
        <div class="cookie-status checking" id="cookieStatus">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <span data-i18n="checkingCookies">Checking claude.ai session...</span>
        </div>

        <button class="btn-primary" id="cookieConnect" data-i18n="connectWithCookie">Connect with Claude.ai Session</button>

        <div class="cookie-hint">
          <span data-i18n="cookieHint">This mode automatically uses your claude.ai browser session. Make sure you're logged in to claude.ai in Chrome.</span>
        </div>
      </div>

      <!-- Token Mode Content -->
      <div class="auth-content" id="tokenContent">
        <div class="file-hint" id="openCredentialsModal">
          <span data-i18n="copyPath">Click to copy .credentials.json path</span>
        </div>

        <label data-i18n="pasteJson">Paste your .credentials.json content:</label>
        <textarea id="modalJsonInput" placeholder='{"claudeAiOauth":{"accessToken":"sk-ant-oat01-..."}}'></textarea>

        <div id="modalParseResult"></div>

        <button class="btn-primary" id="modalSave" data-i18n="saveConnect">Save & Connect</button>
      </div>

      <div class="modal-footer">v4.0 - <span data-i18n="version">Paste the entire JSON file content</span></div>
    </div>
  </div>

  <script src="popup-modern.js"></script>
</body>
</html>
